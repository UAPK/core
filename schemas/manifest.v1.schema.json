{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://uapk.dev/schemas/manifest.v1.json",
  "title": "UAPK Manifest",
  "description": "JSON schema for UAPK Agent Manifest v1",
  "type": "object",
  "required": ["version", "agent", "capabilities"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Manifest schema version"
    },
    "agent": {
      "type": "object",
      "description": "Agent identification",
      "required": ["id", "name", "version"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z0-9][a-z0-9-]{2,62}$",
          "description": "Unique agent identifier"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Human-readable agent name"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+",
          "description": "Agent version (semver)"
        },
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "Agent description"
        },
        "organization": {
          "type": "string",
          "pattern": "^org-[a-z0-9-]+$",
          "description": "Organization ID"
        },
        "team": {
          "type": "string",
          "pattern": "^team-[a-z0-9-]+$",
          "description": "Team ID"
        }
      }
    },
    "capabilities": {
      "type": "object",
      "description": "Capability declarations",
      "required": ["requested"],
      "properties": {
        "requested": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*:[a-z][a-z0-9-*]*$"
          },
          "description": "List of requested capabilities (e.g., 'email:send')"
        }
      }
    },
    "constraints": {
      "type": "object",
      "description": "Self-imposed constraints",
      "properties": {
        "max_actions_per_hour": {
          "type": "integer",
          "minimum": 1,
          "description": "⚠️ NOT YET ENFORCED - Maximum actions per hour (planned for future release)"
        },
        "max_actions_per_day": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum actions per day"
        },
        "require_human_approval": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Actions that require human approval"
        },
        "allowed_hours": {
          "type": "object",
          "description": "⚠️ NOT YET ENFORCED - Time window restrictions (planned for future release)",
          "properties": {
            "start": {
              "type": "string",
              "pattern": "^\\d{2}:\\d{2}$",
              "description": "Start time in HH:MM format"
            },
            "end": {
              "type": "string",
              "pattern": "^\\d{2}:\\d{2}$",
              "description": "End time in HH:MM format"
            },
            "timezone": {
              "type": "string",
              "description": "IANA timezone (e.g., 'America/New_York')"
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "contact": {
          "type": "string",
          "format": "email"
        },
        "documentation": {
          "type": "string",
          "format": "uri"
        },
        "source": {
          "type": "string",
          "format": "uri"
        }
      }
    },
    "policy": {
      "type": "object",
      "description": "Policy configuration for gateway enforcement",
      "properties": {
        "budgets": {
          "type": "object",
          "description": "⚠️ PARTIALLY ENFORCED - Budget limits per action type. Currently only global daily_cap is enforced. Per-action-type budgets and hourly limits are planned for future release.",
          "additionalProperties": {
            "type": "object",
            "description": "Budget configuration for an action type",
            "properties": {
              "daily_limit": {
                "type": "integer",
                "minimum": 0,
                "description": "✅ ENFORCED - Maximum actions per day for this action type"
              },
              "hourly_limit": {
                "type": "integer",
                "minimum": 0,
                "description": "⚠️ NOT YET ENFORCED - Maximum actions per hour for this action type (planned for future release)"
              },
              "total_limit": {
                "type": "integer",
                "minimum": 0,
                "description": "⚠️ NOT YET ENFORCED - Total lifetime actions for this action type (planned for future release)"
              }
            }
          }
        },
        "counterparty_allowlist": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Only allow these counterparties (domain suffixes)"
        },
        "counterparty_denylist": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Block these counterparties (domain suffixes)"
        },
        "jurisdiction_allowlist": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Only allow these jurisdictions (ISO country codes)"
        },
        "tool_allowlist": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Only allow these tools"
        },
        "tool_denylist": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Block these tools"
        },
        "amount_caps": {
          "type": "object",
          "description": "Maximum amounts per currency/unit",
          "additionalProperties": {
            "type": "number",
            "minimum": 0
          }
        },
        "approval_thresholds": {
          "type": "object",
          "description": "✅ ENFORCED - Actions that require human approval before execution",
          "properties": {
            "amount": {
              "type": "number",
              "minimum": 0,
              "description": "Require approval for amounts above this threshold"
            },
            "currency": {
              "type": "string",
              "description": "Currency for amount threshold (e.g., 'USD')"
            },
            "action_types": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Require approval for these action types"
            },
            "tools": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Require approval for these tools"
            }
          },
          "additionalProperties": false
        },
        "require_capability_token": {
          "type": "boolean",
          "default": false,
          "description": "Require valid capability token for all actions"
        }
      },
      "additionalProperties": false
    },
    "tools": {
      "type": "object",
      "description": "Tool connector configurations (tool_name -> config)",
      "additionalProperties": {
        "type": "object",
        "description": "Configuration for a tool connector",
        "required": ["type", "config"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["http_request", "webhook", "mock"],
            "description": "Connector type"
          },
          "config": {
            "type": "object",
            "description": "Connector-specific configuration",
            "additionalProperties": true
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
