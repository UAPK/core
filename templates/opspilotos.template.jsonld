{
  "@context": "https://uapk.ai/context/v0.1",
  "@id": "urn:uapk:{{ agent_prefix }}:v1",
  "uapkVersion": "0.1",
  "name": "{{ business_name }}",
  "description": "{{ description | default('Autonomous SaaS Business-in-a-Box') }}",
  "executionMode": "{{ execution_mode | default('dry_run') }}",

  "cryptoHeader": {
    "hashAlg": "sha256",
    "manifestHash": "",
    "planHash": "",
    "merkleRoot": "",
    "signature": "dev-signature-placeholder",
    "signedBy": "{{ agent_prefix }}-Dev-Key",
    "signedAt": null
  },

  "corporateModules": {
    "governance": {
      "roles": ["Owner", "Admin", "Operator", "Viewer"],
      "approvalWorkflow": {
        "defaultApprovers": ["Owner", "Admin"],
        "escalationTimeoutMinutes": {{ escalation_timeout | default(60) }},
        "requiredApprovals": 1
      },
      "auditRetentionDays": {{ audit_retention_days | default(2555) }}
    },

    "policyGuardrails": {
      "toolPermissions": {
        "IntakeAgent": ["read_deliverable_requests", "read_tickets", "update_ticket_status"],
        "FulfillmentAgent": ["read_kb", "generate_content", "export_pdf", "store_artifact"],
        "BillingAgent": ["create_invoice", "read_subscription", "write_ledger"],
        "TaxAgent": ["read_invoices", "compute_vat", "generate_vat_report"],
        "PolicyAgent": ["evaluate_policy", "create_hitl_request"],
        "SupportAgent": ["read_tickets", "draft_response"],
        "SREAgent": ["read_metrics", "create_incident"]
      },
      "denyRules": [
        "delete_audit_events",
        "modify_closed_invoices"
      ],
      "rateLimits": {
        "actionsPerMinute": {{ actions_per_minute | default(100) }},
        "invoicesPerDay": {{ invoices_per_day | default(500) }},
        "nftMintsPerDay": {{ nft_mints_per_day | default(10) }}
      },
      "liveActionGates": [
        {% if enable_nft_minting %}
        "mint_nft",
        {% endif %}
        "send_invoice_email",
        "mark_invoice_paid",
        "send_customer_email",
        "charge_payment_method"
      ]
    },

    "productOps": {
      "slas": {
        "deliverableCompletionHours": {{ deliverable_completion_hours | default(24) }},
        "supportResponseHours": 4,
        "invoiceGenerationHours": 1
      },
      "retryPolicy": {
        "maxRetries": 3,
        "backoffSeconds": 10
      },
      "idempotencyWindowSeconds": 3600
    },

    "legalCompliance": {
      "disclaimers": [
        "This deliverable was generated by an autonomous AI system. Please review before use.",
        "{{ business_name }} operates under strict policy controls. All actions are logged and auditable."
      ],
      "piiHandling": "encrypt-at-rest",
      "dpaFlags": {
        "gdprCompliant": true,
        "ccpaCompliant": true
      },
      "retentionWindows": {
        "userDataDays": 730,
        "auditLogsDays": 2555,
        "invoicesDays": 3650
      },
      "dsarWorkflow": "manual-review-required"
    },

    "financeOps": {
      "chartOfAccounts": {
        "4000": "Revenue - Services",
        "4100": "Revenue - Subscriptions",
        "1000": "Accounts Receivable",
        "2000": "VAT Payable",
        "3000": "Deferred Revenue"
      },
      "invoiceNumberingScheme": "INV-{year}-{seq:05d}",
      "payoutPolicy": "simulated"
    },

    "taxOps": {
      "vatRates": {
        "DE": 0.19,
        "FR": 0.20,
        "GB": 0.20,
        "NL": 0.21
      },
      "reverseChargeCountries": ["DE", "FR", "GB", "NL", "IT", "ES"],
      "validationMethod": "simulated"
    }
  },

  "aiOsModules": {
    "connectors": {
      "database": {
        "type": "sqlite",
        "config": {
          "path": "{{ database_path | default('runtime/{{agent_prefix}}.db') }}"
        }
      },
      "llm": {
        "type": "simulated",
        "config": {
          "provider": "{{ llm_provider | default('local-stub') }}",
          "modelId": "{{ llm_model | default('deterministic-v1') }}"
        }
      }
    },

    "agentProfiles": [
      {
        "agentId": "{{ agent_prefix }}-intake-agent",
        "role": "Request Monitor",
        "capabilities": ["read_deliverable_requests", "read_tickets", "update_ticket_status"],
        "maxActionsPerMinute": 10
      },
      {
        "agentId": "{{ agent_prefix }}-fulfillment-agent",
        "role": "Content Generator",
        "capabilities": ["read_kb", "generate_content", "export_pdf", "store_artifact"],
        "maxActionsPerMinute": 5
      },
      {
        "agentId": "{{ agent_prefix }}-billing-agent",
        "role": "Invoice Manager",
        "capabilities": ["create_invoice", "read_subscription", "write_ledger"],
        "maxActionsPerMinute": 20
      }
    ],

    "workflowDefinitions": [
      {
        "workflowId": "deliverable_fulfillment",
        "name": "Deliverable Fulfillment Pipeline",
        "trigger": "new_deliverable_request",
        "sla": "24 hours"
      }
    ]
  }
}
